<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigvardsson Story App</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="logo-nav">
                <h1>Magiska Ber√§ttelser</h1>
            </div>
            <div class="login-nav">
                <a href="#" class="login-button" onclick="showLoginModal()">Logga in</a>
            </div>
        </nav>

        <section class="hero">
            <h1>Magiska ber√§ttelser f√∂r ditt barn</h1>
            <p class="tagline">Vi skapar personliga AI-genererade ber√§ttelser som g√∂r ditt barn till huvudpersonen</p>
            <button class="primary-button" onclick="showSignupModal()" style="max-width: 300px; margin: 2rem auto 0;">Kom ig√•ng</button>
        </section>

        <main class="main-content">
            <div class="welcome-section">
                <h2>Om oss</h2>
                <p class="intro-text">
                    Vi √§r ett svenskt par som ville ge andra f√∂r√§ldrars barn 
                    m√∂jligheten att f√• vackra, personliga ber√§ttelser att minnas f√∂r alltid.
                </p>
                <p class="intro-text">
                    Varje ber√§ttelse skapas unikt baserat p√• ditt barns personlighet, favoriter och speciella minnen.
                </p>
            </div>
        </main>

        <!-- Login Modal -->
        <div id="loginModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="hideLoginModal()">&times;</span>
                <div class="login-form">
                    <h3>Logga in</h3>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="loginEmail">E-post</label>
                            <input type="email" id="loginEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">L√∂senord</label>
                            <input type="password" id="loginPassword" name="password" required>
                        </div>
                        <button type="submit" class="primary-button">Logga in</button>
                        <p style="text-align: center; margin-top: 1rem; color: #6c757d;">
                            Inget konto? <a href="#" onclick="showSignupModal()" style="color: var(--primary-color);">Skapa ett konto</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Signup Modal -->
        <div id="signupModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="hideSignupModal()">&times;</span>
                <div class="login-form">
                    <h3>Skapa ett konto</h3>
                    <form id="signupForm">
                        <div class="form-group">
                            <label for="firstName">Namn</label>
                            <input type="text" id="firstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Efternamn</label>
                            <input type="text" id="lastName" name="lastName" required>
                        </div>
                        <div class="form-group">
                            <label for="signupEmail">Mejladress</label>
                            <input type="email" id="signupEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">L√∂senord</label>
                            <input type="password" id="signupPassword" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Upprepa l√∂senord</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" required>
                        </div>
                        <button type="submit" class="primary-button">Skapa konto</button>
                        <p style="text-align: center; margin-top: 1rem; color: #6c757d;">
                            Har redan ett konto? <a href="#" onclick="showLoginModal()" style="color: var(--primary-color);">Logga in</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Story Creation Modal -->
        <div id="storyModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="hideStoryModal()">&times;</span>
                <div class="login-form">
                    <h3>Skapa en magisk ber√§ttelse</h3>
                    <p class="intro-text" style="text-align: center; margin-bottom: 2rem;">
                        Fyll i informationen nedan s√• skapar vi en personlig ber√§ttelse f√∂r ditt barn.
                    </p>
                    
                    <form id="storyForm" onsubmit="handleStoryForm(event)">
                        <div class="form-group">
                            <label for="childName">Barnets namn *</label>
                            <input type="text" id="childName" name="childName" required>
                        </div>

                        <div class="form-group">
                            <label for="childAge">√Ölder *</label>
                            <select id="childAge" name="childAge" required>
                                <option value="">V√§lj √•lder</option>
                                <option value="3">3 √•r</option>
                                <option value="4">4 √•r</option>
                                <option value="5">5 √•r</option>
                                <option value="6">6 √•r</option>
                                <option value="7">7 √•r</option>
                                <option value="8">8 √•r</option>
                                <option value="9">9 √•r</option>
                                <option value="10">10 √•r</option>
                                <option value="11">11 √•r</option>
                                <option value="12">12 √•r</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="childHeight">Ungef√§r l√§ngd</label>
                            <input type="text" id="childHeight" name="childHeight" placeholder="t.ex. 120 cm">
                        </div>

                        <div class="form-group">
                            <label for="favoriteFood">Favoritmat *</label>
                            <input type="text" id="favoriteFood" name="favoriteFood" placeholder="t.ex. pannkakor, k√∂ttbullar" required>
                        </div>

                        <div class="form-group">
                            <label for="favoriteActivity">Favoritaktivitet *</label>
                            <input type="text" id="favoriteActivity" name="favoriteActivity" placeholder="t.ex. m√•la, spela fotboll, l√§sa b√∂cker" required>
                        </div>

                        <div class="form-group">
                            <label for="bestMemory">B√§sta minne tillsammans *</label>
                            <textarea id="bestMemory" name="bestMemory" placeholder="Beskriv ett speciellt minne ni delar tillsammans..." required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="personality">Barnets personlighet</label>
                            <textarea id="personality" name="personality" placeholder="Beskriv ditt barns personlighet, vad som g√∂r hen unik..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="gender">K√∂n *</label>
                            <select id="gender" name="gender" required>
                                <option value="">V√§lj k√∂n</option>
                                <option value="pojke">Pojke</option>
                                <option value="flicka">Flicka</option>
                                <option value="annat">Annat/Vill inte specificera</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="hairColor">H√•rf√§rg *</label>
                            <select id="hairColor" name="hairColor" required>
                                <option value="">V√§lj h√•rf√§rg</option>
                                <option value="ljust">Ljust</option>
                                <option value="blont">Blont</option>
                                <option value="brunt">Brunt</option>
                                <option value="m√∂rkt">M√∂rkt/Svart</option>
                                <option value="r√∂tt">R√∂tt</option>
                                <option value="gr√•tt">Gr√•tt</option>
                                <option value="f√§rgat">F√§rgat/Ovanligt</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="favoriteColor">Favoritf√§rg *</label>
                            <select id="favoriteColor" name="favoriteColor" required>
                                <option value="">V√§lj favoritf√§rg</option>
                                <option value="r√∂d">R√∂d</option>
                                <option value="bl√•">Bl√•</option>
                                <option value="gr√∂n">Gr√∂n</option>
                                <option value="gul">Gul</option>
                                <option value="rosa">Rosa</option>
                                <option value="lila">Lila/Violett</option>
                                <option value="orange">Orange</option>
                                <option value="turkos">Turkos</option>
                                <option value="vit">Vit</option>
                                <option value="svart">Svart</option>
                                <option value="rainbow">Regnb√•ge/M√•nga f√§rger</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="drawings">Barnets teckningar *</label>
                            <div class="file-upload-container">
                                <input type="file" id="drawings" name="drawings" accept=".jpg,.jpeg,.png,.gif,.bmp,.webp,.heic,.heif,.pdf,.tiff,.tif" multiple required>
                                <div class="file-upload-info">
                                    <p class="file-help-text">Ladda upp foton av ditt barns teckningar. Du kan v√§lja flera bilder samtidigt.</p>
                                    <p class="file-format-text">Accepterade format: JPEG, PNG, GIF, BMP, WebP, HEIC, PDF, TIFF</p>
                                </div>
                                <div id="file-preview" class="file-preview"></div>
                            </div>
                        </div>

                        <button type="submit" class="primary-button">Skapa ber√§ttelse</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Book Order Modal -->
    <div id="bookOrderModal" class="modal" style="display: none;">
        <div class="modal-content book-order-modal">
            <span class="close" onclick="hideBookOrderModal()">&times;</span>
            <div id="bookOptionsContainer">
                <!-- Book options will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Stripe Payment Modal -->
    <div id="stripePaymentModal" class="modal" style="display: none;">
        <div class="modal-content stripe-payment-modal">
            <span class="close" onclick="hidePaymentModal()">&times;</span>
            <div id="paymentContainer">
                <!-- Two-column layout inspired by modern checkout designs -->
                <div class="checkout-container">
                    <!-- Left Column: Product Info -->
                    <div class="product-summary-column">
                        <div class="product-showcase">
                            <div class="product-image-container">
                                <img src="https://via.placeholder.com/200x200/8B4513/FFFFFF?text=Din+Bok" alt="Din personliga bok" class="product-image">
                            </div>
                            <div class="product-details">
                                <h2 id="payment-book-title" class="product-title">Premium Hardcover</h2>
                                <p id="payment-book-details" class="product-specs">8" √ó 8" Square ‚Ä¢ 10 pages</p>
                                <p id="payment-story-info" class="story-title">"Magisk Ber√§ttelse" f√∂r ditt barn</p>
                            </div>
                        </div>
                        
                        <div class="order-total">
                            <div class="price-breakdown">
                                <div class="price-item">
                                    <span>Bok</span>
                                    <span id="payment-book-price">18.99‚Ç¨</span>
                                </div>
                                <div class="price-item">
                                    <span>Frakt</span>
                                    <span id="payment-shipping">8.50‚Ç¨</span>
                                </div>
                                <div class="price-divider"></div>
                                <div class="price-item total">
                                    <span>Totalt</span>
                                    <span id="payment-total">27.49‚Ç¨</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Payment Form -->
                    <div class="payment-form-column">
                        <div class="payment-header">
                            <h3>Betala f√∂r din best√§llning</h3>
                            <div class="security-badges">
                                <span class="security-badge">üîí S√§kert</span>
                                <span class="powered-by">Powered by <strong>Stripe</strong></span>
                            </div>
                        </div>

                        <!-- Payment Methods -->
                        <div class="payment-methods">
                            <!-- Apple Pay Button -->
                            <button class="apple-pay-button" onclick="simulateApplePay()">
                                <div class="apple-pay-logo">üçé</div>
                                <span>Pay</span>
                            </button>
                            
                            <div class="divider-text">
                                <span>Eller betala med kort</span>
                            </div>

                            <!-- Contact Info -->
                            <div class="form-section">
                                <h4 class="section-title">Kontaktinformation</h4>
                                <div class="form-group">
                                    <input type="email" id="customer-email" placeholder="E-postadress" required>
                                </div>
                            </div>

                            <!-- Shipping Info -->
                            <div class="form-section">
                                <h4 class="section-title">Leveransadress</h4>
                                <div class="form-group">
                                    <input type="text" id="shipping-name" placeholder="Namn" required>
                                </div>
                                <div class="form-group">
                                    <select id="shipping-country" required>
                                        <option value="SE" selected>Sverige</option>
                                        <option value="NO">Norge</option>
                                        <option value="DK">Danmark</option>
                                        <option value="FI">Finland</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <div class="form-group half">
                                        <input type="text" id="shipping-address" placeholder="Adress" required>
                                    </div>
                                    <div class="form-group half">
                                        <input type="text" id="shipping-postal" placeholder="Postnummer" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="shipping-city" placeholder="Stad" required>
                                </div>
                            </div>

                            <!-- Payment Method -->
                            <div class="form-section">
                                <h4 class="section-title">Betals√§tt</h4>
                                
                                <!-- Payment Method Options -->
                                <div class="payment-options">
                                    <label class="payment-option active" data-method="card">
                                        <input type="radio" name="payment-method" value="card" checked>
                                        <div class="option-content">
                                            <div class="option-icon">üí≥</div>
                                            <span>Kort</span>
                                        </div>
                                    </label>
                                    
                                    <label class="payment-option" data-method="bank">
                                        <input type="radio" name="payment-method" value="bank">
                                        <div class="option-content">
                                            <div class="option-icon">üè¶</div>
                                            <span>Bank</span>
                                        </div>
                                    </label>
                                    
                                    <label class="payment-option" data-method="klarna">
                                        <input type="radio" name="payment-method" value="klarna">
                                        <div class="option-content">
                                            <div class="option-icon">üî∑</div>
                                            <span>Klarna</span>
                                            <small>K√∂p nu, betala senare</small>
                                        </div>
                                    </label>
                                </div>

                                <!-- Card Details -->
                                <div id="card-details" class="card-details-section">
                                    <div class="form-group">
                                        <div id="card-element" class="stripe-element">
                                            <!-- Stripe Elements or demo form goes here -->
                                        </div>
                                        <div id="card-errors" class="card-errors" role="alert"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Cards Info -->
                            <div class="test-mode-notice">
                                <h5>üß™ Test Mode</h5>
                                <div class="test-cards">
                                    <div class="test-card">‚úÖ Godk√§nt: 4242 4242 4242 4242</div>
                                    <div class="test-card">‚ùå Avvisat: 4000 0000 0000 0002</div>
                                </div>
                                <p>Anv√§nd vilken framtida m√•nad/√•r och CVC som helst</p>
                            </div>

                            <!-- Submit Button -->
                            <form id="payment-form">
                                <button type="submit" id="submit-payment" class="pay-now-button">
                                    <span id="button-text">Slutf√∂r best√§llning - <span id="button-price">27.49‚Ç¨</span></span>
                                    <div id="payment-spinner" class="spinner hidden"></div>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://js.stripe.com/v3/"></script>
    <script src="supabase-config.js"></script>
    <script src="script.js"></script>
    <link rel="stylesheet" href="story-styles.css">
</body>
</html>